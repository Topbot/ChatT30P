@using System.Web.Optimization
@using Core
<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Мониторинг приватных чатов Телеграм</title>
    <link rel="shortcut icon" href="/images/chat_monitoring.svg" type="image/svg+xml" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="keywords" lang="ru" content="вконтакте,ютуб,дискорд,телеграм,youtube,одноклассники,твиттер,инстаграм,google plus" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="yandex-verification" content="2aa0d373aace54fe" />
    @Styles.Render("~/css")
    <script type="text/javascript">
    var UserVars = {
        Name: '@(Request.IsAuthenticated ? (Security.CurrentUser.Identity.Name ?? "") : "")',
        IsAuthenticated: @Request.IsAuthenticated.ToString().ToLower(),
        IsAdmin: @Security.IsAdmin.ToString().ToLower(),
        IsPaid: @Security.IsPaid.ToString().ToLower()
    };
    var ServerTime = '@DateTime.Now'
    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
        var msViewportStyle = document.createElement("style");
        var mq = "@@-ms-viewport{width:auto!important}";
        msViewportStyle.appendChild(document.createTextNode(mq));
        document.getElementsByTagName("head")[0].appendChild(msViewportStyle);
    }
    </script>
</head>
<body data-ng-app="stats" data-ng-controller="ChatAccountsController">
    <script type="text/javascript" src="admin.res.axd"></script>
    <div id="modal-log-file" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-user"></i></button>
                    <h4 class="modal-title">Вам необходимо залогиниться для продолжения</h4>
                </div>
    <div id="modal-select-chats" class="modal fade" style="z-index:1062;">
        <div class="modal-dialog modal-select-chats">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Выбор чатов для мониторинга</h4>
                </div>
                <div class="modal-body chat-select-modal-body">
                    <div class="chat-select-actions">
                    <input type="text" class="form-control" placeholder="Фильтр по названию..." style="display:inline-block;width:260px;margin-right:10px;" data-ng-model="$root.chatFilterText" />
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                    <button type="button" class="btn btn-default" data-ng-click="$root.clearChatSelection && $root.clearChatSelection()">Очистить выбор</button>
                    <button type="button" class="btn btn-default" data-ng-click="$root.selectAllChats && $root.selectAllChats()">Выбрать все</button>
                    <button type="button" class="btn btn-info" data-ng-click="$root.refreshChatsList && $root.refreshChatsList()" data-ng-disabled="$root._refreshingChats">
                        <span data-ng-if="!$root._refreshingChats">Обновить список чатов</span>
                        <span data-ng-if="$root._refreshingChats"><i class="fa fa-spinner fa-spin"></i></span>
                    </button>
                    <button type="button" class="btn btn-primary" data-ng-click="$root.saveChatSelection && $root.saveChatSelection()" data-ng-disabled="$root._savingChatSelection">
                        <span data-ng-if="!$root._savingChatSelection">Сохранить выбор</span>
                        <span data-ng-if="$root._savingChatSelection"><i class="fa fa-spinner fa-spin"></i></span>
                    </button>
                    </div>
                    <div class="chat-select-body">
                        <div class="text-muted" style="margin-bottom:10px;">
                            Выберите чаты, сообщения в которых будут мониториться.
                            <label style="font-weight: normal; margin-left: 10px;">
                                <input type="checkbox" data-ng-model="$root.onlyChatType" data-ng-change="$root.toggleChatTypeFilter('chat')" /> оставлять только чаты
                            </label>
                            <label style="font-weight: normal; margin-left: 10px;">
                                <input type="checkbox" data-ng-model="$root.onlyForumType" data-ng-change="$root.toggleChatTypeFilter('forum')" /> только форумы
                            </label>
                        </div>
                        <div data-ng-if="!$root.availableChats || $root.availableChats.length === 0" class="text-muted">
                            Список чатов пуст. Нажмите «Обновить список чатов».
                        </div>
                        <div data-ng-if="$root.availableChats && $root.availableChats.length > 0" class="chat-select-list">
                            <div class="chat-select-items">
                                <label class="chat-select-item" data-ng-repeat="c in $root.availableChats | filter:{ title: $root.chatFilterText } | filter:$root.chatTypeFilter">
                                    <input type="checkbox"
                                           data-ng-change="$root.toggleChatSelection(c)"
                                           data-ng-model="$root.selectedChatMap[c.id]" />
                                    <i class="fa fa-comments" data-ng-if="c.type === 'chat'" title="Чат"></i>
                                    <i class="fa fa-comments-o" data-ng-if="c.type === 'topic'" title="Форум"></i>
                                    <span>{{c.title}}</span>
                                    <small class="text-muted" data-ng-if="c.last"> — {{$root.truncateChatLast(c.last)}}</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                <div class="modal-body modal-logfile">
                    Зарегистрировавшись на сайте, вы сможете продолжить работу с сервисом мониторинга закрытых домовых чатов.
                    <br />
                    <br />
                    Сервис помогает собирать аналитику по сообщениям, отслеживать проблемные темы и обращения жильцов, а также оценивать настроения в чатах по динамике обсуждений.
                    <br />
                    <br />
                    Для подключения дополнительных функций (выгрузки, расширенная аналитика, интеграции) напишите мне на почту.
                </div>
                <div class="modal-footer">
                    Почта для вопросов:&nbsp;<a href="mailto:topbot@yandex.ru">topbot@yandex.ru</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button onclick="document.location.href = '/Account/login.aspx';" class="btn btn-success"><i class="fa fa-user"></i>Войти</button>
                    <button onclick="document.location.href = '/Account/register.aspx';" class="btn btn-success"><i class="fa fa-plus-square"></i>Зарегистрироваться</button>
                </div>
            </div>
		</div>
	</div>

    <div id="modal-no-permission" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-ban"></i></button>
                    <h4 class="modal-title">Недостаточно прав</h4>
                </div>
                <div class="modal-body">
                    У вас нет прав для доступа к этому разделу.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-wait" class="modal fade" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-sm" style="margin-top: 15%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Пожалуйста, подождите</h4>
                </div>
                <div class="modal-body" style="text-align:center;">
                    <i class="fa fa-spinner fa-spin" style="font-size:24px;"></i>
                    <div style="margin-top:10px;">Создаём профиль…</div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-login-required" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Залогинивание аккаунта</h4>
                </div>
                <div class="modal-body">
                    Вам скоро придёт код. Пожалуйста, введите его в поле для залогинивания аккаунта.
                    <br />
                    <br />
                    <div class="text-muted" style="margin-bottom:10px;">
                        Обычно отправка кода занимает около 3 минут — не переживайте, если код не пришёл сразу.
                    </div>
                    <div style="text-align:center; margin-bottom:10px;" data-ng-if="qrLoading && !qrCodeUrl">
                        <i class="fa fa-spinner fa-spin" style="font-size:24px;"></i>
                    </div>

                    <div data-ng-if="qrCodeUrl" style="display:flex; justify-content:center; align-items:center; margin-bottom:10px;">
                        <img data-ng-src="{{qrCodeUrl}}" style="width:300px; max-width:100%; height:auto; object-fit:contain; display:block;" alt="QR" />
                    </div>
                    <div class="text-muted" style="margin-bottom:10px;">
                        Окно закроется через: <strong id="login-timer-text" data-ng-bind="loginTimerText"></strong>
                    </div>
                    <input type="text"
                           class="form-control"
                            placeholder="Код (до 6 цифр)"
                           inputmode="numeric"
                           pattern="\d*"
                           maxlength="6"
                           autocomplete="one-time-code"
                           data-ng-model="$root.loginCode"
                           data-ng-change="$root.onLoginCodeChange && $root.onLoginCodeChange()" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                    <button type="button" class="btn btn-primary" style="position:relative; z-index:1061;" data-ng-click="$event.preventDefault(); $event.stopPropagation(); $root.submitLoginCode && $root.submitLoginCode();" data-ng-disabled="$root._submittingCode || !$root.isLoginCodeValid || !$root.currentPlatform || !$root.currentPhone">
                        <span data-ng-if="!$root._submittingCode">Отправить</span>
                        <span data-ng-if="$root._submittingCode"><i class="fa fa-spinner fa-spin"></i></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-no-subscription" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-exclamation-triangle"></i></button>
                    <h4 class="modal-title">Нет активной подписки</h4>
                </div>
                <div class="modal-body">
                    Добавлять телефоны могут только пользователи с активной подпиской.
                    <br />
                    <br />
                    Для подключения тарифа напишите на почту: <a href="mailto:topbot@yandex.ru">topbot@yandex.ru</a>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <div id="container" class="app-wrapper ltr">
        <div data-ng-view="" id="ng-view"></div>
    </div>

    @Scripts.Render("~/js")
</body>
</html>
